import type { NextPage } from 'next'
import Head from 'next/head'
import styles from '../styles/Home.module.css'
import Post from '../components/Post/Post';
import {client} from './_app';
import type { Post as PostType }  from '../utils/types';
import { GET_POSTS } from '../utils/queries';
import Postinput from '../components/Postinput/Postinput';

interface HomeProps { 
  posts: PostType[]
}

const Home: NextPage<HomeProps> = ({ posts }: HomeProps) => {
  return (
    <div className={styles.body}>
      <Head>
        <title>Next Blog</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Postinput />
      
      <div className={styles.container}>
        {posts?.map((post: PostType, index) => (
          <Post post={post} key={index}/>
        ))}
      </div>
    </div>
  )
}

export const getServerSideProps =  async () => {
  const { data } = await client.query({query: GET_POSTS});
  return {
    props: {
      posts: data.getPosts
    }
  }
}

export default Home;
